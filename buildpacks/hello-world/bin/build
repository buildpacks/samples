#!/usr/bin/env bash
set -eo pipefail

echo "---> Hello World buildpack"

# INPUT ARGUMENTS
env_dir=$2/env
layers_dir=$1
plan_path=$3

# ENV VARS
echo "     env_dir: ${env_dir}"
echo "     env vars:"
if compgen -G "${env_dir}/*" > /dev/null; then
  for var in ${env_dir}/*; do
    declare "$(basename ${var})=$(<${var})"
  done
fi
export | sed 's/^/       /'

# VOLUMES
volume_file=/platform/volume/volume_contents.txt
if [[ -f "$volume_file" ]]; then
  echo "     reading volume contents:"
  echo "         $(cat /platform/volume/volume_contents.txt)"
else
  echo "     no volumes found under /platform/volume"
fi

# LAYERS
echo "     layers_dir: ${layers_dir}"

# PLAN
echo "     plan_path: ${plan_path}"
echo "     plan contents:"
cat ${plan_path} | sed 's/^/       /'
echo

echo "---> Done"
